!function(a,b){"use strict";a.mailtolink=b(a)}(this,function(a){"use strict";function b(a,b){var c=URI(a.attr("href")),d=URI(b.url),e=c.query(!0);for(var f in e)d.setQuery(f,e[f]);b.paramMailto&&d.setQuery(b.paramMailto,c.path()),b.paramThen&&d.setQuery(b.paramThen,b.urlThen);var g=d.href();return g}function c(a){var b=a;return $.each(h["default"],function(c,d){return c.toLowerCase()===a?(b=c,!1):void 0}),b}function d(a,b){var d=!1,e={},f="data-ml-";$.each(a.attributes,function(){if(this.specified){var a=this.name;0===a.lastIndexOf("data-ml-")&&(a=a.slice(f.length),e[c(a)]=this.value,d=!0)}});var g={};return g=d?$.extend({},b,e):b}function e(a){a.preventDefault();var b=a.data.$form,c=$("#"+a.data.id),d=a.data.opts,e=b.serialize(),f=d.urlPost?d.urlPost:b.attr("action");if(d.msgSelector){var g=$(d.msgSelector);g.removeClass("alert alert-success alert-info alert-warning alert-danger"),g.addClass("alert alert-info"),g.html(d.msgSending)}$.ajax(f,{data:e,method:"POST",success:function(a,b,c){if(console.log("mail result = "+a),d.msgSelector){var e=$(d.msgSelector);e.removeClass("alert alert-success alert-info alert-warning alert-danger"),e.addClass("alert alert-success"),e.html(d.msgSuccess(a,b,c))}},error:function(a,b,c){var e=$(d.msgSelector);e.removeClass("alert alert-success alert-info alert-warning alert-danger"),e.addClass("alert alert-danger"),e.html(d.msgError(a,b,c))}}),c.modal("hide")}function f(a,b,c){var d=new URI(a.attr("href"));a.attr("href","#"+b),a.attr("data-target","#"+b),a.attr("data-toggle","modal");var f=$("<span></span>"),g=c.url+(c.formSelector?" "+c.formSelector:"");f.load(g,function(){$(this).find(".modal").attr("id",b);var a=$("#"+b+" form");c.paramMailto&&a.find('[name="'+c.paramMailto+'"]').val(d.path()),c.title&&$(this).find(".modal-title").html(c.title),h.fillFromQuery(a,c.url),h.fillFromQuery(a,d),a.find('input[type="submit"]').click({$form:a,id:b,opts:c},e)}),f.prependTo("body"),f.modal({show:!1}),f.on("shown.bs.modal",function(a){$(a.target).find("input, textarea").first().focus()})}function g(a,c){var e=d(a[0],h.opts),g=e.action;switch(g){case"redirect":var i=b(a,e);a.attr("href",i),e["new"]&&a.attr("target","_blank");break;case"popup":var j="mailto-"+c;a.attr("data-ml-id",j),f(a,j,e);break;default:console.log("Unknown action: "+g)}}var h={"default":{action:"redirect",url:null,"new":!1,urlThen:window.location.href,urlPost:null,paramMailto:"mailto",paramThen:"then",formSelector:"form",msgError:function(a,b,c){return"Error ["+a.status+"]: "+c},msgSuccess:function(a,b,c){return"Mail succesfully sent"},msgSending:"Sending mail...",msgSelector:"#mailto-msg"},opts:{}};return h.init=function(a){h.opts=$.extend({},h["default"],h.opts,a),$('a[href^="mailto:"]').each(function(a){g($(this),a)})},h.fillFromQuery=function(a,b){a||(a=h.opts.formSelector);var c;c="string"==typeof a?$(a):a;var d;b||(b=window.location.href),d="string"==typeof b?new URI(b):b;var e=d.query(!0);c.find("input, textarea").each(function(a){var b=$(this).attr("name");b&&e[b]&&$(this).val(e[b])})},h});